services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./data:/app/data
      - ./app:/app/app
    environment:
      - FLASK_ENV=${FLASK_ENV:-production}
      - FLASK_DEBUG=${FLASK_DEBUG:-0}
      - DATABASE_PATH=/app/data/menudb.db
      - SECRET_KEY=${SECRET_KEY:-dev-secret-key-change-in-production}
    restart: unless-stopped

  # Test environment
  web-test:
    build: .
    ports:
      - "5001:5000"
    volumes:
      - ./data:/app/data
      - ./app:/app/app
      - ./tests:/app/tests
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DATABASE_PATH=/app/data/test.db
      - SECRET_KEY=test-secret-key
      - TESTING=1
    profiles:
      - test
    command: >
      sh -c "python -m tests.test_db_init && flask run --host=0.0.0.0"
